
CREATE TABLE BVL_COMPANY
(
    STOCK CHAR(10),
    CATEGORY VARCHAR(20)
)


CREATE TABLE BVL_INCOME_STATEMENT
(
    STOCK CHAR(10),
    ITEM VARCHAR(50),
    YEAR CHAR(4),
    QUARTER CHAR(1),
    VALUE FLOAT,
    CURRENCY CHAR(3)
)


CREATE TABLE BVL_BALANCE_SHEET
(
    STOCK CHAR(10),
    ITEM VARCHAR(50),
    YEAR CHAR(4),
    QUARTER CHAR(1),
    VALUE FLOAT,
    CURRENCY CHAR(3)
)


CREATE TABLE BVL_CASH_FLOW
(
    STOCK CHAR(10),
    ITEM VARCHAR(50),
    YEAR CHAR(4),
    QUARTER CHAR(1),
    VALUE FLOAT,
    CURRENCY CHAR(3)
)


CREATE VIEW V_INCOME_STATISTICS
AS

    SELECT 
        A.STOCK, 
        A.YEAR,
        A.QUARTER,
        A.VALUE AS SALES,
        GI.VALUE AS GROSS_INCOME,
        NI.VALUE AS NET_INCOME,
        EB.VALUE AS EBITDA,
        EPB.VALUE AS EPS_BASIC,
        EPD.VALUE AS EPS_DILUTED,
        A.CURRENCY
    FROM BVL_INCOME_STATEMENT AS A
    
        LEFT JOIN BVL_INCOME_STATEMENT AS GI
        ON GI.STOCK=A.STOCK
        AND GI.ITEM='Gross Income'
        AND GI.YEAR=A.YEAR
        AND GI.QUARTER=A.QUARTER
        AND GI.CURRENCY=A.CURRENCY
    
        LEFT JOIN BVL_INCOME_STATEMENT AS EB
        ON EB.STOCK=A.STOCK
        AND EB.ITEM='EBITDA'
        AND EB.YEAR=A.YEAR
        AND EB.QUARTER=A.QUARTER
        AND EB.CURRENCY=A.CURRENCY
    
        LEFT JOIN BVL_INCOME_STATEMENT AS NI
        ON NI.STOCK=A.STOCK
        AND NI.ITEM='Net Income'
        AND NI.YEAR=A.YEAR
        AND NI.QUARTER=A.QUARTER
        AND NI.CURRENCY=A.CURRENCY

        LEFT JOIN BVL_INCOME_STATEMENT AS EPB
        ON EPB.STOCK=A.STOCK
        AND EPB.ITEM='EPS (Basic)'
        AND EPB.YEAR=A.YEAR
        AND EPB.QUARTER=A.QUARTER
        AND EPB.CURRENCY=A.CURRENCY

        LEFT JOIN BVL_INCOME_STATEMENT AS EPD
        ON EPD.STOCK=A.STOCK
        AND EPD.ITEM='EPS (Diluted)'
        AND EPD.YEAR=A.YEAR
        AND EPD.QUARTER=A.QUARTER
        AND EPD.CURRENCY=A.CURRENCY
        
    WHERE A.ITEM='Sales/Revenue';


CREATE VIEW V_BALANCE_SHEET
AS

    SELECT 
        C.STOCK,
        C.YEAR,
        C.QUARTER,
        C.CURRENCY,
        C.VALUE AS TOTAL_CURRENT_ASSETS,
        TA.VALUE AS TOTAL_ASSETS,
        TCL.VALUE AS TOTAL_CURRENT_LIABILITIES,
        TL.VALUE AS TOTAL_LIABILITIES,
        CE.VALUE AS COMMON_EQUITY,
        RE.VALUE AS RETAINED_EARNINGS,
        TEQ.VALUE AS TOTAL_EQUITY,
        NI.VALUE AS NET_INCOME
    FROM BVL_BALANCE_SHEET AS C
    
        LEFT JOIN BVL_BALANCE_SHEET AS TA
        ON TA.STOCK=C.STOCK
        AND TA.YEAR=C.YEAR
        AND TA.QUARTER=C.QUARTER
        AND TA.ITEM='Total Assets'
        AND TA.CURRENCY=C.CURRENCY
        
        LEFT JOIN BVL_BALANCE_SHEET AS TCL
        ON TCL.STOCK=C.STOCK
        AND TCL.YEAR=C.YEAR
        AND TCL.QUARTER=C.QUARTER
        AND TCL.ITEM='Total Current Liabilities'
        AND TCL.CURRENCY=C.CURRENCY
    
        LEFT JOIN BVL_BALANCE_SHEET AS TL
        ON TL.STOCK=C.STOCK
        AND TL.YEAR=C.YEAR
        AND TL.QUARTER=C.QUARTER
        AND TL.ITEM='Total Liabilities'
        AND TL.CURRENCY=C.CURRENCY
        
        LEFT JOIN BVL_BALANCE_SHEET AS CE
        ON CE.STOCK=C.STOCK
        AND CE.YEAR=C.YEAR
        AND CE.QUARTER=C.QUARTER
        AND CE.ITEM='Common Equity (Total)'
        AND CE.CURRENCY=C.CURRENCY
        
        LEFT JOIN BVL_BALANCE_SHEET AS RE
        ON RE.STOCK=C.STOCK
        AND RE.YEAR=C.YEAR
        AND RE.QUARTER=C.QUARTER
        AND RE.ITEM='Retained Earnings'
        AND RE.CURRENCY=C.CURRENCY
        
        LEFT JOIN BVL_BALANCE_SHEET AS TEQ
        ON TEQ.STOCK=C.STOCK
        AND TEQ.YEAR=C.YEAR
        AND TEQ.QUARTER=C.QUARTER
        AND TEQ.ITEM='Total Equity'
        AND TEQ.CURRENCY=C.CURRENCY

        LEFT JOIN BVL_INCOME_STATEMENT AS NI
        ON NI.STOCK=C.STOCK
        AND NI.YEAR=C.YEAR
        AND NI.QUARTER=C.QUARTER
        AND NI.ITEM='Net Income'
        AND NI.CURRENCY=C.CURRENCY
    
    WHERE C.ITEM='Total Current Assets';


INSERT INTO BVL_COMPANY 
VALUES ('CASAGRC1', 'AGRO'),
('CARTAVC1', 'AGRO'),
('LAREDOC1', 'AGRO'),
('CPACASC1', 'INDUSTRIAL'),
('UNACEMC1', 'INDUSTRIAL'),
('FERREYC1', 'INDUSTRIAL'),
('SIDERC1', 'INDUSTRIAL'),
('CORAREI1', 'INDUSTRIAL'),
('PODERC1', 'MINING'),
('CVERDEC1', 'MINING'),
('SCCO', 'MINING'),
('MINSURI1', 'MINING'),
('ALICORC1', 'MASSIVE CONSUMPTION'),
('BACKUSI1', 'MASSIVE CONSUMPTION'),
('INRETC1', 'MASSIVE CONSUMPTION'),
('LUSURC1', 'UTILITIES'),
('ENGEPEC1', 'UTILITIES'),
('ENDISPC1', 'UTILITIES'),
('HIDRA2C1', 'UTILITIES'),
('ENGIEC1', 'UTILITIES'),
('BBVAC1', 'FINANCE'),
('CREDITC1', 'FINANCE'),
('SCOTIAC1', 'FINANCE'),
('INTERBC1', 'FINANCE');



SELECT * FROM BVL_COMPANY

SELECT * FROM BVL_INCOME_STATEMENT
where LOWER(STOCK) IN ('minsuri1', 'scco', 'engiec1', 'inretc1', 'bap', 'ifs', 'scotiac1', 'bbvac1');

select stock, count(*) as total 
from bvl_income_statement
group by stock


SELECT * FROM BVL_INCOME_STATEMENT
WHERE ITEM LIKE '%Growth%';

SELECT * FROM V_INCOME_STATISTICS
ORDER BY STOCK, YEAR, QUARTER;


//delete FROM BVL_INCOME_STATEMENT
//WHERE STOCK IN ('CASAGRC1', 'CARTAVC1', 'LAREDOC1')


SELECT A.*, B.CATEGORY FROM V_INCOME_STATISTICS AS A
    LEFT JOIN BVL_COMPANY AS B
    ON B.STOCK=A.STOCK
ORDER BY B.CATEGORY


SELECT * FROM BVL_BALANCE_SHEET

    

SELECT * FROM BVL_BALANCE_SHEET
WHERE upper(item)='TOTAL LIABILITIES'


SELECT 
    STOCK, COUNT(*)
FROM BVL_BALANCE_SHEET
GROUP BY STOCK

delete from BVL_CASH_FLOW
WHERE STOCK IN ('CASAGRC1', 'CARTAVC1', 'LAREDOC1')


SELECT * FROM BVL_CASH_FLOW

SELECT 
    STOCK, COUNT(*)
FROM bvl_cash_flow
GROUP BY STOCK



